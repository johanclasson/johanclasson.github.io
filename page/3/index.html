<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Johan Classon Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Johan Classon Blog">
<meta property="og:url" content="https://blog.classon.eu/page/3/index.html">
<meta property="og:site_name" content="Johan Classon Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Johan Classon">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Johan Classon Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Johan Classon Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.classon.eu"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2015-05-16-Avoid-Connection-String-Transforms-with-SQL-Client-Alias" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-05-16-Avoid-Connection-String-Transforms-with-SQL-Client-Alias/" class="article-date">
  <time datetime="2015-05-15T22:00:00.000Z" itemprop="datePublished">2015-05-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-05-16-Avoid-Connection-String-Transforms-with-SQL-Client-Alias/">Avoid Connection String Transforms With SQL Client Alias</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Your reality as a programmer if often that the application that you and your team are writing is going to be run on a number of test- and production environments. The normal case is that these contain computers with different names and/or DNS addresses.</p>
<p>This means that your application configuration needs to be different on each and every environment. There exists a bunch of tools to solve this problem, and it is usually done with transformation of configuration files. Ouch! </p>
<p>Now, can you imagine a world where transformations of configuration files are not needed? At least not due to different addresses to the database server.</p>
<h2 id="SQL-Native-Client-Alias"><a href="#SQL-Native-Client-Alias" class="headerlink" title="SQL Native Client Alias"></a>SQL Native Client Alias</h2><p>A feature of SQL Server is that its clients can use aliases for database instances. You can call an alias whatever you want, and it can be run over either TCP or Named Pipes. This is not a miracle per se, since similar functionality can be achieved with help of a DNS-server, or why not an entry in the Windows host file.</p>
<p>What a SQL Client Alias can do that none other can, is to point out a named database instance on a target computer. But most importantly, configuring an alias does not require any out of the ordinary access rights (administrative rights to be precise). Developers does not typically have access to tamper with the company DNS server, and are usually too lazy to install their own…</p>
<p>Something that is a bit troublesome with SQL Client Aliases is that there exists 32- and 64-bit versions. It would have been reasonable that they shared the same list of configured aliases, but they do not. If you have both types of applications, you have to configure your alias twice.</p>
<h3 id="Configuring-with-SQL-Server-Configuration-Manager"><a href="#Configuring-with-SQL-Server-Configuration-Manager" class="headerlink" title="Configuring with SQL Server Configuration Manager"></a>Configuring with SQL Server Configuration Manager</h3><p>To be able to connect to a SQL Server through an alias, the server needs to enable access over either Named Pipes or TCP/IP. This can be done by fiddling in SQL Server Configuration Manager, followed by a restart of the SQL Server service.</p>
<p><img src="./sql-alias-enable-protocols.png" alt="Enable SQL Server Protocols"></p>
<p>Then to create a new alias, enter it under one of the nodes named SQL Native Client 11.0 Configuration, like so.</p>
<p><img src="./sql-alias-enable-sscm-alias.png" alt="Set SQL Client Alias With SSCM"></p>
<p>The good part with this method of configuring an alias is that you will probably be able to remember how to start SQL Server Configuration Manager, but the bad part is that it will only be available on a computer that has the features Client Components and Management Tools of SQL Server installed. </p>
<p>Having SQL Server installed on your development machine is fine, but what if you do not want to install it on environment client machines?</p>
<h3 id="Configuring-with-cliconfg-exe"><a href="#Configuring-with-cliconfg-exe" class="headerlink" title="Configuring with cliconfg.exe"></a>Configuring with cliconfg.exe</h3><p>Since Windows 2000-isch, an application called <code>cliconfig.exe</code> has come bundled with Windows which can be used to configure SQL Client Aliases. Nice! Sounds promising.</p>
<p>You can start it by running <code>cliconfig.exe</code> from the Run Dialog, since it is already included in PATH. Wait… If only it was that easy. You need to be aware of that when run like this on a 32-bit OS, the 32-bit <code>cliconfig.exe</code> will be run. Naturally on a 64-bit OS, the 64-bit version will be run. You must consider which version your applications actually require and start the same version of <code>cliconfig.exe</code>.</p>
<p><img src="./sql-alias-enable-cliconfig-alias.png" alt="Set SQL Client Alias With cliconfig.exe"></p>
<p>To start a specific version, please use the following paths (no, they are not mixed up): </p>
<ul>
<li>32-bit, <code>C:\windows\syswow64\cliconfg.exe</code></li>
<li>64-bit, <code>C:\windows\system32\cliconfg.exe</code></li>
</ul>
<p>Ouch again! To have to configure both 32- and 64-bit aliases is a pain, is there no better way to do this? </p>
<h3 id="PowerShell-to-the-rescue"><a href="#PowerShell-to-the-rescue" class="headerlink" title="PowerShell to the rescue"></a>PowerShell to the rescue</h3><p>Luckily, configured aliases are stored in the Windows registry. Therefore it is possible to automate the task of setting up SQL Client Alias with PowerShell.</p>
<p>An example of how this can be done: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function Set-SqlClientAlias &#123;</span><br><span class="line">    param(</span><br><span class="line">        [Parameter(Position&#x3D;0, Mandatory&#x3D;$true)]</span><br><span class="line">        [string]$Alias,</span><br><span class="line">        [Parameter(Position&#x3D;1, Mandatory&#x3D;$true)]</span><br><span class="line">        [string]$Instance,</span><br><span class="line">        [Parameter(Position&#x3D;2, Mandatory&#x3D;$false)]</span><br><span class="line">        [int]$Port &#x3D; -1</span><br><span class="line">    )</span><br><span class="line">    function Set-RegistryValue([string]$Path, [string]$Name, [string]$Value) &#123;</span><br><span class="line">        if (-not (Test-Path $Path)) &#123;</span><br><span class="line">            New-Item $Path | Out-Null</span><br><span class="line">        &#125;</span><br><span class="line">        New-ItemProperty -Path $Path -Name $Name -PropertyType String -Value $Value -Force | Out-Null</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $x86Path &#x3D; &quot;HKLM:\Software\Microsoft\MSSQLServer\Client\ConnectTo&quot;</span><br><span class="line">    $x64Path &#x3D; &quot;HKLM:\Software\Wow6432Node\Microsoft\MSSQLServer\Client\ConnectTo&quot;</span><br><span class="line">    $Value &#x3D; &quot;DBMSSOCN,$Instance&quot; # DBMSSOCN &#x3D;&gt; TCP&#x2F;IP</span><br><span class="line">    if ($Port -ne -1) &#123;</span><br><span class="line">        $Value +&#x3D; &quot;,$Port&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Set-RegistryValue -Path $x86Path -Name $Alias -Value $Value</span><br><span class="line">    Set-RegistryValue -Path $x64Path -Name $Alias -Value $Value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I have intentionally left out the ability to use the Named Pipe protocol since I think it is not of much use in this case. Databases are often run on dedicated servers, so your application cannot talk to them with pipes anyway. If you really want to use Named Pipes anyway the registry item value should look something like <code>DBNMPNTW,\\myserver\pipe\sql\query</code>.</p>
<p>I wish you a pleasant configuration experience! :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.classon.eu/2015-05-16-Avoid-Connection-String-Transforms-with-SQL-Client-Alias/" data-id="ck93pvv4q00016syg414jg5su" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2015-05-12-Hidden-Capabilities-of-PowerShell-ISE-IntelliSense" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-05-12-Hidden-Capabilities-of-PowerShell-ISE-IntelliSense/" class="article-date">
  <time datetime="2015-05-11T22:00:00.000Z" itemprop="datePublished">2015-05-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-05-12-Hidden-Capabilities-of-PowerShell-ISE-IntelliSense/">Hidden Capabilities of PowerShell ISE IntelliSense</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I do not program in PowerShell daily, but at least once or twice a week. Even though I am far from an expert on the matter, I would like to think of myself as a guy that knows the available commands. </p>
<p>Normally I have used the PowerShell ISE that comes bundled with Windows Management Framework to edit my scripts. As of late I have been looking around for another IDE, but have not found any that I feel lives up to my expectations.</p>
<p>I have come to realize that of the capabilities that I value the most, code completion (or ?IntelliSense? as Microsoft calls it) is the most important. When I know the syntax it is relieving to know that what I write is correctly spelled. When I do not know, it is convenient to not have to spam the command prompt with the Get-Command and Get-Member cmdlets.</p>
<p>Powershell ISE is frankly a quite crappy text editor, but I think it has the best code completion of all PowerShell editors out there. That feature alone makes it a winner.</p>
<h2 id="How-it-use-PowerShell-ISE-IntelliSense"><a href="#How-it-use-PowerShell-ISE-IntelliSense" class="headerlink" title="How it use PowerShell ISE IntelliSense"></a>How it use PowerShell ISE IntelliSense</h2><p>The IntelliSense menu is often invoked automatically when you write. But if you for example accidently close it, you can get it back by hitting <code>Ctrl + Space</code>.</p>
<p><img src="./powershell-intellisense-ise-normal.png" alt="An example of Powershell IntelliSense"></p>
<p>What also works is hitting tab to complete the word to the top suggestion of what is in the IntelliSense list. If it is not what you want you can continue hitting tab to cycle through the suggestions.</p>
<p>This works on cmdlets, paths, variables, properties and classes of .Net instances, DSC-configuration, and what not. I bet that every PowerShell developer out there are aware. But what at least I did not know of until today is the following two.</p>
<h3 id="Command-history"><a href="#Command-history" class="headerlink" title="Command history"></a>Command history</h3><p>If you write <code>#</code> followed by <code>Ctrl + Space</code> you get a list of the latest commands which were run in the console.</p>
<p><img src="./powershell-intellisense-ise-dash.png" alt="Command History with Powershell IntelliSense"></p>
<p>This is ideal for inserting commands in your script that you have tested out in the console first. Or when writing commands in the console, you can get the history by other means than hitting the arrow keys repeatedly.</p>
<h3 id="Completion-of-type-namespace"><a href="#Completion-of-type-namespace" class="headerlink" title="Completion of type namespace"></a>Completion of type namespace</h3><p>As a .Net developer I am used to be able to include all types in a namespace of a resource with the using-statement. Unfortunately, there exist no equivalent in PowerShell. This was a real PITA. At least for me, up until today.</p>
<p>Powershell IntelliSense can type out the namespace of a type for you. Simply write the class name followed by <code>Ctrl + Space</code> and magic happens.</p>
<p><img src="./powershell-intellisense-ise-type.png" alt="Type Namespace Completion with PowerShell"></p>
<p>In this case <code>[messagebox</code> will be expanded to <code>[System.Windows.Forms.MessageBox</code>. Not that I actually would like to use a WinForms message box in a PowerShell script, but this is just a stupid example.</p>
<p>To use this functionality with class libraries you have written yourself you need to first import them with either <code>Add-Type</code> or <code>[System.Reflection.Assembly]::Load*</code>-methods.</p>
<p>I thought this was absolutely thrilling, and I hope you will find it interesting at least! :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.classon.eu/2015-05-12-Hidden-Capabilities-of-PowerShell-ISE-IntelliSense/" data-id="ck93ug7vp0001dsyge0dc8rdx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2015-05-06-WCF-Service-Hosting-made-Easy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-05-06-WCF-Service-Hosting-made-Easy/" class="article-date">
  <time datetime="2015-05-05T22:00:00.000Z" itemprop="datePublished">2015-05-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-05-06-WCF-Service-Hosting-made-Easy/">WCF Service Hosting Made Easy</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I often hear that WCF is hard to work with because it needs so much configuration. That might have been true in .Net 3.5, but since .Net 4.0 <code>&lt;serviceActivations&gt;</code> has been around to make our lives easier. Today, .Net 4.0 is not far from the Stone Age… So I am surprised that this is still an issue.</p>
<p>To get started simply:</p>
<ol>
<li>Create empty ASP.Net Web Application</li>
<li>Add reference to System.ServiceModel.dll</li>
<li>Add the <code>&lt;system.serviceModel&gt;</code> tag from the snippet below in your Web.config</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">system.serviceModel</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">protocolMapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">clear</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">add</span> <span class="attr">scheme</span>=<span class="string">"net.pipe"</span> <span class="attr">binding</span>=<span class="string">"netNamedPipeBinding"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">add</span> <span class="attr">scheme</span>=<span class="string">"net.tcp"</span> <span class="attr">binding</span>=<span class="string">"netTcpBinding"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">add</span> <span class="attr">scheme</span>=<span class="string">"http"</span> <span class="attr">binding</span>=<span class="string">"basicHttpBinding"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">protocolMapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">serviceHostingEnvironment</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">serviceActivations</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">add</span> <span class="attr">service</span>=<span class="string">"Example.Wcf.MyService"</span> <span class="attr">relativeAddress</span>=<span class="string">"./myservice.svc"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">factory</span>=<span class="string">"System.ServiceModel.Activation.ServiceHostFactory"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">serviceActivations</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">serviceHostingEnvironment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">system.serviceModel</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You now have a convenient way to host WCF services by adding references to all Class Libraries that contain your service implementations. To get the Service Hosting Environment to pick up your services, all you have to do is to point them out with an extra <code>&lt;add /&gt;</code> under <code>&lt;serviceActivations&gt;</code>.</p>
<p>This approach has a number of advantages:</p>
<ul>
<li>The hosting code is close to zero, which makes it easy to reach 100% code coverage through unit testing.</li>
<li>All services automatically gets endpoints over many protocols, which makes the information flow in your application more configurable.</li>
<li>In addition to the service implementation, there is no need for metadata files just to make hosting possible.</li>
</ul>
<p>Below is an example of a service implementation.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Example.Wcf</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ServiceContract</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IMyService</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">OperationContract</span>]</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">Add</span>(<span class="params"><span class="keyword">int</span> x, <span class="keyword">int</span> y</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyService</span> : <span class="title">IMyService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">Add</span>(<span class="params"><span class="keyword">int</span> x, <span class="keyword">int</span> y</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="IoC"><a href="#IoC" class="headerlink" title="IoC"></a>IoC</h2><p>To make it easier to test the services that I write, I often use IoC containers of some sort to handle dependency resolution. The default <code>ServiceHostFactory</code> does not let you configure the container.</p>
<p>To do this with Unity you can replace the factory with a UnityServiceHostFactory, which can be found in the NuGet-package Unity.Wcf.</p>
<h2 id="Client-Proxies"><a href="#Client-Proxies" class="headerlink" title="Client Proxies"></a>Client Proxies</h2><p>Please do not use WCF clients generated with Add ? Add Service Reference… They are hard to maintain and dispose of correctly.</p>
<p>One way to create a proxy to a WCF service is to inherit <code>ClientBase&lt;T&gt;</code>. It works pretty well, except that someone at Microsoft must have made a mistake when implementing its Dispose functionality. Or more precise, its lack of. According to <a href="https://msdn.microsoft.com/en-us/library/aa355056.aspx" target="_blank" rel="noopener">their recommendations</a>; to be sure to close the proxy once you are done using it, the client code should be bloated with enormous try-catch blocks.</p>
<p>What is natural for me is to use using-blocks, but apparently this is not possible without some customization.</p>
<h3 id="Custom-Client-Proxy"><a href="#Custom-Client-Proxy" class="headerlink" title="Custom Client Proxy"></a>Custom Client Proxy</h3><p>Out on the ?internet?, there exists many suggestions how to do this. What has been working for me is to use the following wrapper around the <code>ClientBase&lt;T&gt;</code>.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel.Channels;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Example.Wcf</span></span><br><span class="line">&#123;</span><br><span class="line">    public interface IServiceClient&lt;T&gt; : IDisposable where T : class</span><br><span class="line">    &#123;</span><br><span class="line">        T Proxy &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class ServiceClient&lt;T&gt; : IServiceClient&lt;T&gt; where T : class</span><br><span class="line">    &#123;</span><br><span class="line">        private class ClientProxy&lt;TChannel&gt; : ClientBase&lt;TChannel&gt; where TChannel : class</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">ClientProxy</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">ClientProxy</span>(<span class="params">Binding binding, EndpointAddress remoteAddress</span>) : <span class="title">base</span>(<span class="params">binding, remoteAddress</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> TChannel Proxy</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">get</span> &#123; <span class="keyword">return</span> Channel; &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> _disposed;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ClientProxy&lt;T&gt; _clientProxy; </span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ServiceClient</span>(<span class="params">Binding binding, EndpointAddress remoteAddress</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            _clientProxy = <span class="keyword">new</span> ClientProxy&lt;T&gt;(binding, remoteAddress);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ServiceClient</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            _clientProxy = <span class="keyword">new</span> ClientProxy&lt;T&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T Proxy</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> _clientProxy.Proxy; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Dispose(<span class="literal">true</span>);</span><br><span class="line">            GC.SuppressFinalize(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"><span class="keyword">bool</span> disposing</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_disposed)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span> (!disposing)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span> (_clientProxy.State == CommunicationState.Faulted)</span><br><span class="line">            &#123;</span><br><span class="line">                _clientProxy.Abort();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                _clientProxy.Close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span></span><br><span class="line">            &#123;</span><br><span class="line">                _clientProxy.Abort();</span><br><span class="line">            &#125;</span><br><span class="line">            _disposed = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ~ServiceClient()</span><br><span class="line">        &#123;</span><br><span class="line">            Dispose(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With it you can either provide the client configuration in your App/Web.config like so:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">system.serviceModel</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">client</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">address</span>=<span class="string">"net.pipe://localhost/Example.Wcf/myservice.svc"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">binding</span>=<span class="string">"netNamedPipeBinding"</span> <span class="attr">contract</span>=<span class="string">"Example.Wcf.IMyService"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">client</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">system.serviceModel</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Or inject it manually in the <code>ServiceClient(Binding, EndpointAddress)</code> constructor.</p>
<p>How do you use prefer to use WCF clients?</p>
<h2 id="Project-Example"><a href="#Project-Example" class="headerlink" title="Project Example"></a>Project Example</h2><ul>
<li><a href="https://github.com/johanclasson/ServiceConfig" target="_blank" rel="noopener">https://github.com/johanclasson/ServiceConfig</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.classon.eu/2015-05-06-WCF-Service-Hosting-made-Easy/" data-id="ck93ug7vq0002dsyg5wpkdyvc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2015-05-05-Dirty-Harry-Planning-with-TFS" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-05-05-Dirty-Harry-Planning-with-TFS/" class="article-date">
  <time datetime="2015-05-04T22:00:00.000Z" itemprop="datePublished">2015-05-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-05-05-Dirty-Harry-Planning-with-TFS/">Dirty Harry Planning With TFS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Planning is hard. If you overestimate your ability to beforehand know details of the future, your planning will fail. Even if you only plan for a two week iteration. Like Harry Callahan said in Magnum Force, <a href="https://www.youtube.com/watch?v=_VrFV5r8cs0" target="_blank" rel="noopener">?a man’s got to know his limitations?</a>.</p>
<h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>This article is based on the Scrum Process Template, since I think it is the most popular one.</p>
<p>If used right, TFS is a great tool for planning project work. Unfortunately it is fairly common that its planning capabilities are used in a counterproductive way which can make TFS hard to work with.</p>
<ul>
<li>If lots of PBIs are added to the backlog it makes it hard to get an overview. For example to know which PBIs needs more attention before they can be started to work on, one need to categorize them somehow. Some do it by a parent-child relationship between PBIs, but then it hard to prioritize between PBIs belonging to different parents since TFS orders the backlog by their respective parents.</li>
<li>People tend to focus on the Iteration Backlog which makes it easy to forget about the more important large scoped workflows. It is common that the team focus on micro managing stuff that really does not matter, like task beak down and estimation. It is not uncommon to find PBIs with more than ten tasks added to them.</li>
<li>Most tasks are added during the planning meeting, but almost always some are added during the sprint to cover for details which was not initially thought of. Some call this scope creep, but it should really be called bad planning.</li>
</ul>
<h3 id="Discussion"><a href="#Discussion" class="headerlink" title="Discussion"></a>Discussion</h3><p>When planning, a primary concern should be making PBIs that are small enough so that they can be delivered when the sprint is over. The larger a PBI gets, the higher the risk that it does not reach ?done? (whatever that means for your team) at the end of the sprint. Half-finished PBIs need to be split which is not only a time consuming activity in itself, but is also bad for accuracy of the Velocity key metric.</p>
<p>Your coworkers depend on the state of the PBI and not the state of its tasks. For example, a test specialist might be interested in PBIs that are ready to be tested. A developer specialist wanting to start working on a PBI might be interested in when a dependent upon PBI is implemented. If the team hangs around in the Sprint Backlog these states are not visual enough, nor are they easy to update.</p>
<p>If the team backlog is a mix of PBIs that are ready to work on, and some are not, it is hard to know what items to handle during a grooming meeting. The result in the long run can be a backlog full of junk which is prioritized in an order that cannot be trusted.</p>
<h3 id="Why-using-tasks-might-be-a-bad-idea"><a href="#Why-using-tasks-might-be-a-bad-idea" class="headerlink" title="Why using tasks might be a bad idea"></a>Why using tasks might be a bad idea</h3><p>If you are used of adding tasks to a PBI you might feel that it is not that important to fill in the Description field. When the description field is empty you will most likely forget about the Acceptance Criteria as well.</p>
<p>One can question the tradeoff from using tasks in your team. Is it really that important for you to check in code against a task? Are your burndown charts that precious that you must have them? Especially if they do not even slope downward, as often is the case.</p>
<p>If you do not have tasks, you are forced to do a better job creating the PBIs. For example, they automatically get smaller and with more detailed information. Project stakeholders will be happy. And as a nice bonus for yourself, you are no longer asked to estimate bogus hours on tasks. When was the last time that it played out as you thought? Everybody wins!</p>
<p>Well, using tasks might be a good idea for some. Maybe your project has very few dependencies, your team is experienced and you know very well what has to be done. But still, the first step for everyone should be to get familiar with PBIs and how they should be used. Then after you think you have mastered their creation and workflow activities, go ahead and use tasks. </p>
<h2 id="How-to-use-TFS-to-keep-a-clean-backlog"><a href="#How-to-use-TFS-to-keep-a-clean-backlog" class="headerlink" title="How to use TFS to keep a clean backlog"></a>How to use TFS to keep a clean backlog</h2><p>It is a bad idea to keep your planning of future sprints in the team backlogs.</p>
<p>One might be tempted to do the planning in another tool, but that is not optimal either. It is always best to keep all related information in the same place. TFS actually comes with the possibility to have different backlogs for different teams, which solves this problem.</p>
<p>In a project consisting of two teams, one might use the following configuration:</p>
<h3 id="Teams"><a href="#Teams" class="headerlink" title="Teams"></a>Teams</h3><ul>
<li>Root Team, can access both team backlogs</li>
<li>PO Team, planning of future PBIs</li>
<li>Team 1</li>
<li>Team 2</li>
</ul>
<h3 id="Area-configuration"><a href="#Area-configuration" class="headerlink" title="Area configuration"></a>Area configuration</h3><ul>
<li>Future, default for PO Team</li>
<li>Team, default for Root Team<ul>
<li>1, default for Team 1</li>
<li>2, default for Team 2</li>
</ul>
</li>
</ul>
<p>Planning for the future and grooming activities are performed in the PO team, which results in clean backlogs for the other two teams. Most of the time, they will only contain items from the current sprint. This makes the Backlog Items Board usable in the iteration. The combined status of the teams can be examined through the Root Team backlog.</p>
<h3 id="Customizing-Kanban-Columns"><a href="#Customizing-Kanban-Columns" class="headerlink" title="Customizing Kanban Columns"></a>Customizing Kanban Columns</h3><p>PBIs and Bugs comes with two types of states. The normal New-Approved-Committed-Done state, and a customizable Kanban state. The latter can be thought of like a sub-state of the normal state. It can unfortunately not be shared across teams, but is an easy way to customize the workflow within a team. The Kanban states are represented by columns in the Backlog Items Board.</p>
<p>To illustrate what is possible, I have taken screen shots from the respective team backlogs of my example. These can be customized without changing the Scrum Process Template, which means that it does not matter if you run an On Premise TFS installation or in the cloud service Visual Studio Online.</p>
<h4 id="The-PO-Team-Backlog"><a href="#The-PO-Team-Backlog" class="headerlink" title="The PO Team Backlog"></a>The PO Team Backlog</h4><p><img src="./dirtyharryplanningwithtfs-pobacklog.png" alt="PO backlog"></p>
<p>The PO Team is responsible for creating new PBIs, which are given the new state by default. The Kanban columns Candidates and Grooming are added as sub-states of New. When a PBI is detailed enough so that work can be started it is moved to the Approved column which sets the Approved state. The PBI will not show up in a team backlog until it is moved to the area path of a team.</p>
<p>Note that the Business Value field is added in the cards because it gives great meaning for the PO Team.</p>
<h4 id="The-Team-1-Backlog"><a href="#The-Team-1-Backlog" class="headerlink" title="The Team 1 Backlog"></a>The Team 1 Backlog</h4><p><img src="./dirtyharryplanningwithtfs-team1backlog.png" alt="Team 1 Backlog"></p>
<p>The Team 1 and 2 are responsible for implementing approved PBIs from the PO Team. PBIs which are committed to during a sprint is moved to the Committed state. The Approved state is not shown in the Board since sprint planning is normally done in the Backlog- and not in the Board view.</p>
<p>The Kanban columns Implemented and Testable are added as sub-states of Commited. When tests are passed PBIs are moved to the Done column which sets the Done state.</p>
<h4 id="The-Team-2-Backlog"><a href="#The-Team-2-Backlog" class="headerlink" title="The Team 2 Backlog"></a>The Team 2 Backlog</h4><p><img src="%22./dirtyharryplanningwithtfs-team2backlog.png" alt="Team 2 Backlog"></p>
<p>Here the Kanban columns In Process and Testable are added as sub-states of Committed. In Process use the Split Column functionality.</p>
<h4 id="The-Root-Team-Backlog"><a href="#The-Root-Team-Backlog" class="headerlink" title="The Root Team Backlog"></a>The Root Team Backlog</h4><p><img src="./dirtyharryplanningwithtfs-rootbacklog.png" alt="Root Team Backlog"></p>
<p>The Root Team is not used to do any real work but only view the combined backlogs of Team 1 and 2. Since Kanban states are not shared cross teams there is no use adding any extra columns to the board.</p>
<p>Because work items are included from different teams it gives meaning to display the area path on the cards.</p>
<h3 id="Using-Excel-to-Move-PBIs-between-Areas"><a href="#Using-Excel-to-Move-PBIs-between-Areas" class="headerlink" title="Using Excel to Move PBIs between Areas"></a>Using Excel to Move PBIs between Areas</h3><p>A nice feature of TFS is that you can edit work items through Excel. In short it gets a list of work items from a Query and lets you edit them all in a spreadsheet instead of doing it one by one. It also lets you create new work items or change parent-child relations.</p>
<p>To use this feature you have to have Excel (obviously) and Visual Studio installed. You can read in the <a href="https://msdn.microsoft.com/en-us/library/ms181675.aspx" target="_blank" rel="noopener">instructions on MSDN</a> that it is sufficient to install Team Explorer if you do not already have Visual Studio installed, although I have never tried that for myself.</p>
<p>To get started simply open Excel, under Team ribbon click New List, Select your Query and you are good to go. When you are done editing press Publish to upload your changes to TFS.</p>
<p><img src="./dirtyharryplanningwithtfs-excel.png" alt="Edit Work Items with Excel"></p>
<p>Using the TFS spreadsheet functionality is the most convenient way to move approved PBIs from the PO Team to one of backlogs of Team 1 or 2.</p>
<h3 id="Final-comment"><a href="#Final-comment" class="headerlink" title="Final comment"></a>Final comment</h3><p>Note that there are intentionally no iterations in my example. I did not check any iterations because I would like to help (or force if you are fond of strong words) the teams to keep their PBIs in order.</p>
<p>Happy planning!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.classon.eu/2015-05-05-Dirty-Harry-Planning-with-TFS/" data-id="ck93ug7vn0000dsyg4uqg67qv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019-05-31-Release-Notes-with-Azure-DevOps/">Release Notes With Azure DevOps</a>
          </li>
        
          <li>
            <a href="/2018-11-29-Asynchronously-Wait-for-Task-to-Complete-with-Timeout/">Asynchronously Wait for Task to Complete With Timeout</a>
          </li>
        
          <li>
            <a href="/2018-06-29-Get-started-with-invisible-reCAPTCHA/">Get Started With Invisible reCAPTCHA</a>
          </li>
        
          <li>
            <a href="/2018-05-09-Handle-Secrets-with-.NET-Core/">Handle Secrets With .NET Core</a>
          </li>
        
          <li>
            <a href="/2017-02-10-Creating-ARM-Service-Endpoints-from-Within-VSTS/">Creating ARM Service Endpoints From Within VSTS</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Johan Classon<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>